websocket与断点续传
--

# WebSocket
在TCP连接建立后，还要通过Http进行一次握手，也就是通过Http发送一条GET请求消息给服务器，告诉服务器我要建立WebSocket连接了，你准备好哦，具体做法就是在头部信息中添加相关参数。然后服务器响应我知道了，并且将连接协议改成WebSocket，开始建立长连接。



--

# 分块
传输正常情况下，一次数据发完之后，服务器就会断开链接。


- 所以一般要在请求头中设置Connection字段的值为：keep-alive，表示维持连接不要断开，一直到某个数据包的Connection字段的值为close。


- 另外还有一种办法可以维持TCP连接，就是将请求数据进行分块传输。分块传输指的是服务器发给客户端的数据可以分成多个部分传输。使用方法：


    - 消息头部设置Transfer-Encoding: chunked


    - 每一块会表明长度


    - 由一个标明长度为0的chunk标示结束



--

# 断点续传
指的是客户端想从文件上次中断的地方开始下载或者上传,这样就算遇到网络问题导致下载或上传中断也没事了，保证好的用户体验。


- 使用方法：


    - 客户端请求报文头部信息中加上Range字段，表示要从哪个字节开始下载，到哪个字节结束（Range: bytes=0-499）


    - 服务器端响应报文头部信息中加上Content-Range，表示当前发送的数据的范围，以及文件总大小（Content-Range: bytes 0-499/22400）。


    - ETag字段表示文件的唯一性。


- 实际使用流程：


    - 第一次客户端请求下载，服务器端会返回文件内容，和Etag标示，状态码为200。


    - 第二次客户端请求断点续传，会发送两个头部信息（Range:bytes=200-499，If-Range：Etag）。


    - 然后服务器会判断Etag是否匹配，如果匹配则返回这一部分数据（Content-Range: bytes 200-499/22400），状态码为206，表示这是你请求的部分数据。否则会返回文件全部数据，状态码为200。

